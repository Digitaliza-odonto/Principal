<div id="capaCadastro">
  <br>
    <div>
      <p></p>

      <script>
        // TROCAR STYLE SE O CAMPO 'informaçõesImportantes' for preenchido
      document.addEventListener('DOMContentLoaded', function() {
        const inputField = document.getElementById('informacoesImportantes');
    
        function applyStyles() {
          if (inputField.value.trim() === '') {
            inputField.classList.add('ui-state-default');
            inputField.classList.remove('important-ui');
          } else {
            inputField.classList.add('important-ui');
            inputField.classList.remove('ui-state-default');
          }
        }
    
        inputField.addEventListener('input', applyStyles);
    
        // Apply styles once the page loads
        applyStyles();
      });
    </script>

      <label style="width: 180px; margin: 5px; font-weight: bold;">INFORMAÇÕES IMPORTANTES</label>
      <input type="text" name="informacoesImportantes" id="informacoesImportantes" maxlength="255" style="width: 340px; margin: 5px;"><br>
    

      <p style="margin: 10px;"><span style="margin-left: 15px;">Descrever informações imprescindíveis ao profissional de saúde (ALERGIAS, RELATO DE ABUSO, ETC.)</span></p>
      <p></p>
      <br>
    
      <p></p>
      <br>
    </div>
  
    <p></p>
    <br>
    <hr class="ui-state-default">
    <p></p>
    <br>
  
    <label style="width: 120px; ;margin: 5px;">CPF</label>
    <input type="text" name="CPF" id="CPF" maxlength="" class="ui-state-default ui-corner-all mousetrap CPF" onblur="pesquisaPessoa()" style="width: 100px;">
    <br>
  
    <label style="width: 120px; ;margin: 5px;">Nome</label>
    <input type="text" name="Nome" id="Nome" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 400px;">
    <br>

    <label style="width: 120px; margin: 5px;">Nome social</label>
    <input type="text" name="nomeSocial" id="nomeSocial" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 400px;">
    <br>
    
    <label style="width: 120px; ;margin: 5px;">RG</label>
    <input type="text" name="Rg" id="Rg" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 100px;">
    <br>
  
    <label style="width: 120px; ;margin: 5px;">Cartão SUS (CNS)</label>
    <input type="text" name="CNS" id="CNS" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 100px;">
    <br>
    
    <label style="width: 120px; ;margin: 5px;"  >Dt. nascimento</label>
    <input type="text" name="DataNasc" id="DataNasc" maxlength="10" class="ui-state-default ui-corner-all mousetrap  datepicker" style=" width: 80px;">
    <br>
  
    <label style="width: 120px; ;margin: 5px;">E-mail</label>
    <input type="text" name="Email" id="Email" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 400px;">
    <br>
  
    <label style="width: 120px; ;margin: 5px;">Telefone</label>
    <input type="text" name="Tel" id="Tel" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap telefone" style="width: 100px;">
    <br>
  
    <label style="width: 120px; ;margin: 5px;">Telefone 2 (Opcional)</label>
    <input type="text" name="Tel2" id="Tel2" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap telefone" style="width: 100px;">
    <br>
  
    <label style="width: 120px; ;margin: 5px;">Telefone 3 (Opcional)</label>
    <input type="text" name="Tel3" id="Tel3" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap telefone" style="width: 100px;">
    <br>
    

    <label style="width: 120px; ;margin: 5px;">Estado civil</label>
    <select class="ui-state-default ui-corner-all" style="width: 180px; height: 20px;" name="EstadoCivil" id="EstadoCivil">
        <option value="CASADO">CASADO</option>
        <option value="DIVORCIADO">DIVORCIADO</option>
        <option value="OUTROS">OUTROS</option>
        <option value="SEPARADO">SEPARADO JUDICIALMENTE</option>
        <option value="SOLTEIRO">SOLTEIRO</option>
        <option value="VIUVO">VIUVO</option>
    </select>
    <br>

     <label style="width: 120px; ;margin: 5px;">Sexo</label>
    <select class="ui-state-default ui-corner-all" style="width: 180px; height: 20px;" name="Sexo" id="Sexo">
      <option value="Masculino">Masculino</option>
      <option value="Feminino">Feminino</option>
    </select> 
    <br>

    <label style="width: 120px; ;margin: 5px;">Cor/Raça</label>
    <select class="ui-state-default ui-corner-all" style="width: 180px; height: 20px;" name="CorRaca" id="CorRaca">
      <option value="Amarelo">Amarelo</option>
      <option value="Branca">Branca</option>
      <option value="Indígena">Indígena</option>
      <option value="Negra">Negra</option>
      <option value="Parda">Parda</option>
      <option value="Não quis declarar">Não quis declarar</option>
    </select> 


    <hr class="ui-state-default">
    <label style="font-weight:bold;width: 120px;">Filiação</label>
    <br>

    <label style="width: 120px; margin: 5px;">Nome da mãe</label>
    <input type="text" name="NomeMae" id="NomeMae" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 400px;">

    <br>
    <label style="width: 120px;margin: 5px;">Nome do pai</label>
    <input type="text" name="NomePai" id="NomePai" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 400px;">
    
    <br>
    <hr class="ui-state-default">
    <label style="width: 600px;">Condição sistêmica/Necessidade especial: (Segurar control para fazer seleçoes múltiplas)</label><br>
    <select class="ui-state-default ui-corner-all" style="width: 100px;margin: 5px;" name="PNE" id="PNE" multiple>
      <option value="Hipertensão">Hipertensão</option>
      <option value="Diabetes">Diabetes</option>
      <option value="Hepatite B">Hepatite B</option>
      <option value="Hepatite C">Hepatite C</option>
      <option value="Soropositivo">Soropositivo</option>
    </select> 

    <hr class="ui-state-default"><label style="font-weight:bold;width: 120px;">Endereço:</label>
    <br>
  
    <label style="width: 120px;">Tipo de endereço</label>
    <select class="ui-state-default ui-corner-all" style="width: 180px; height: 20px;" name="EnderecoTipo" id="EnderecoTipo">
      <option value="Comercial">Comercial</option>
      <option value="Família">Família</option>
      <option value="Residencial" selected>Residencial</option>
    </select> 
    <br>
    <p></p><br>

     <label style="width: 120px;">CEP</label>
    <input type="text" name="Cep" id="Cep" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap cep" style="width: 100px;">
    <br>

    <label style="width: 120px;">Endereço</label>
    <input type="text" name="Rua" id="Rua" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 300px;">
    <br>

    <label style="width: 120px;">Número</label>
    <input type="text" name="EndNumero" id="EndNumero" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 100px;">
    <br>

    <label style="width: 120px;">Complemento</label>
    <input type="text" name="EndComplemento" id="EndComplemento" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 300px;">
    <br>

    <label style="width: 120px;">Bairro</label>
    <input type="text" name="Bairro" id="Bairro" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 300px;">
    <br>

    <label style="width: 120px;">Cidade</label>
    <input type="text" name="Cidade" id="Cidade" value="" maxlength="255" class="ui-state-default ui-corner-all mousetrap " style="width: 300px;">
    <br>

    <script src="/API/API.js"></script>

    <script type="text/javascript">

      // CONVERTER DATA EM DD/MM/YYYY
     function formatDate(dateString) {
         const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
         const formattedDate = new Date(dateString).toLocaleDateString('en-GB', options);
         return formattedDate;
     }

     // Função para preencher o formulário com os dados do perfil
       function preencherFormulario(dados) {
         console.log(dados)
         document.getElementById("informacoesImportantes").value = dados.informacoesImportantes;
         document.getElementById("CPF").value = dados.CPF;
         document.getElementById("Nome").value = dados.Nome;
         document.getElementById("nomeSocial").value = dados.nomeSocial;
         document.getElementById("Nometab").innerText = dados.Nome;
         document.getElementById("Rg").value = dados.Rg;
         document.getElementById("CNS").value = dados.CNS;
         document.getElementById('DataNasc').value = formatDate(dados.DataNasc);
         document.getElementById("Email").value = dados.Email;
         document.getElementById("Tel").value = dados.Tel;
         document.getElementById("Tel2").value = dados.Tel2;
         document.getElementById("Tel3").value = dados.Tel3;
         document.getElementById("EstadoCivil").value = dados.EstadoCivil;
         document.getElementById("Sexo").value = dados.Sexo;
         document.getElementById("CorRaca").value = dados.CorRaca;
         document.getElementById("NomeMae").value = dados.NomeMae;
         document.getElementById("NomePai").value = dados.NomePai;
         document.getElementById("PNE").value = dados.PNE;
         document.getElementById("EnderecoTipo").value = dados.EnderecoTipo;
         document.getElementById("Cep").value = dados.Cep;
         document.getElementById("Rua").value = dados.Rua;
         document.getElementById("EndNumero").value = dados.EndNumero;
         document.getElementById("EndComplemento").value = dados.EndComplemento;
         document.getElementById("Bairro").value = dados.Bairro;
         document.getElementById("Cidade").value = dados.Cidade;
       }
   
       // Função para obter parâmetros da URL
       function getUrlVars() {
           var vars = {};
           var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
               vars[key] = decodeURIComponent(value); // Decode URI component to handle special characters
           });
           return vars;
       }

       // Função para buscar o perfil usando a API
       function buscarPerfil() {
           const params = getUrlVars();
           const cpf = params['cpf'];
           const id = params['id'];

           if (cpf) {
               api.pacientes.consultar({ CPF: cpf, ID: id }) // Ensure that your API supports both 'cpf' and 'id' parameters
                   .then((pacientes) => {
                       if (pacientes.length === 0) {
                           console.log('Nenhum paciente encontrado');
                       } else {
                           preencherFormulario(pacientes[0]);
                       }
                   })
                   .catch((error) => {
                       console.error('Erro ao consultar perfil:', error);
                   });
           } else {
               console.log('CPF não encontrado na URL.');
           }
       }

       // Chamar a função para buscar o perfil
       buscarPerfil();
   </script>
</div>