<div id="registrarAtendimento">
    
    <br>
    <p></p>
    <label style="font-weight:bold;width: 180px;">Lista de especialidades</label>
    <select class="ui-state-default ui-corner-all" style="width: 180px; height: 20px;" name="especialidade" id="especialidade">
    <option value="Escolher">Escolher</option>
    <option value="Prótese Dentária">Prótese Dentária</option>
    <option value="Odontopediatria">Odontopediatria</option>
    <option value="Periodontia">Periodontia</option>
    <option value="Dentística">Dentística</option>
    <option value="Cirurgia">Cirurgia</option>
    </select>
    
    <hr class="ui-state-default">
    <p></p>
    <br>
    
    <label style="width: 400px; ;">Descrição do plano de tratamento ou procedimento realizado:</label><br>
    <textarea style="width: 460px;" id="atendimentoDescrição" rows="10" maxlength="1000" class="ui-state-default ui-corner-all" ></textarea>
    <br>

    <label style="width: 180px; ;">Código SUS:</label>
    <button id="btnAddCodSus" value="Adicionar Cód. SUS" class="button">Adicionar Cód. SUS</button>
    <div style="height: 22px; width: 25px; margin: 0px -1px 5px 0px; display: block; float: left; position: relative; padding: 0; text-decoration: none !important; text-align: center; zoom: 1; overflow: visible; border-right: none;" class="ui-widget ui-state-default ui-corner-tl ui-corner-bl ui-button-icon-only"><span class=" ui-icon ui-icon-search"></span></div>
    <input type="text" value="" class="ui-state-default ui-corner-tr ui-corner-br mousetrap" id="atendimentoCodSUS" placeholder="Digite o código SUS" style="width: 240px;" />
    <br>
    
    <label style="width: 180px;">Data do atendimento</label>
    <input type="text" id="atendimentoData" value="" maxlength="10" class="ui-state-default ui-corner-all mousetrap  datepicker" style=" width: 265px;" />
    <br>
    
    <br>
    <label style="width: 180px;">Responsável técnico</label>
    <input type="text" id="responsavelProcedimento" value="" maxlength="10" class="ui-state-default ui-corner-all mousetrap " style=" width: 265px;" placeholder="SELECT BOX OU BUSCAR O NOME?">
    <br>
    
    <label style="width: 180px;">Componente curricular</label>
    <input type="text" id="componenteCurricular" value="" maxlength="10" class="ui-state-default ui-corner-all mousetrap " style=" width: 265px;" placeholder="BUSCAR AUTOMATICAMENTE DO VÍNCULO">
    <br>
    
    <p></p>
    <button id="btnCancelar" onclick="limparCampos()" value="Cancelar" class="button">Limpar campos</button>
    <br>

    <p></p>
    <hr class="ui-state-default">
    <p></p>
    
    <hr class="ui-state-default">
    <div style="margin: 10px;"></div>
    <h2> Listagem de procedimentos SUS realizados</h2>
    <table id="listaCodSUS" class="ui-jqgrid ui-widget ui-widget-content ui-corner-all" cellspacing="0" cellpadding="0" border="0" role="grid" aria-multiselectable="false" style="width: 40%; font-size: 14px; margin: 15px;">
    <thead>
        <tr class="ui-jqgrid-labels" role="rowheader">
            <th class="ui-jqgrid-titlebar ui-widget-header ui-helper-clearfix" style="width: 5%;">Selec.</th>
            <th class="ui-jqgrid-titlebar ui-widget-header ui-helper-clearfix" style="width: 15%;">Código</th>
            <th class="ui-jqgrid-titlebar ui-widget-header ui-helper-clearfix" style="width: 80%;">Procedimento SUS</th>
        </tr>
        </thead>
        <!-- Table body rows go here -->
    </table>
    
    <button name="btnDeletar" id="btnDeletar" value="Deletar" class="button" style="margin: 15px;">Remover código SUS</button>

    <div>
        <input type="hidden" id="aluno_id" value="" maxlength="10" class="ui-state-default ui-corner-all mousetrap " style=" width: 32%;" placeholder="BUSCAR AUTOMATICAMENTE DO VÍNCULO"><br>
    </div>
    
    <!-- AUTOCOMPLETE PROCEDIMENTOS SUS & ADICIONA REMOVE LINHAS NA TABELA DE PROCEDIMENTOS-->
    <script>
        $(document).ready(function () {
            $('#atendimentoCodSUS').autocomplete({
                source: function(request, response) {
                    // Call the getProcedimentos function with user input as a parameter
                    getProcedimentos(request.term).then(function (procedimentos) {
                        // Map the response data and format it as 'cod_sus - nome'
                        const procedimentosList = procedimentos.map(procedimento => ({
                            value: procedimento.cod_sus + ' - ' + procedimento.nome,
                            cod_sus: procedimento.cod_sus, // Store the cod_sus separately for further use if needed
                            nome: procedimento.nome // Store the nome separately for further use if needed
                        }));
                        response(procedimentosList);
                    }).catch(function (error) {
                        console.error('Erro ao consultar procedimentos:', error);
                    });
                },
                minLength: 1,
                select: function (event, ui) {
                    // Handle selection
                    $('#atendimentoCodSUS').val(ui.item.value); // Set input value to 'cod_sus - nome'
                    console.log('Selected Cod_sus:', ui.item.cod_sus);
                    console.log('Selected Nome:', ui.item.nome);
                }
            });

            function getProcedimentos(term) {
                // Fetch procedimentos from API based on user input
                return api.procedimentos.consultar(term)
                    .then(function (procedimentos) {
                        console.log(procedimentos);
                        return procedimentos;
                    })
                    .catch(function (error) {
                        console.error('Erro ao consultar procedimentos:', error);
                        throw error;
                    });
            }
        });
    
    document.getElementById("btnAddCodSus").addEventListener("click", function () {
        var atendimentoCodSUS = document.getElementById("atendimentoCodSUS").value;
        addCodSUSRow(atendimentoCodSUS);
    });
    
    document.getElementById("btnDeletar").addEventListener("click", function () {
        deleteSUSRows();
    });
    
    function addCodSUSRow(codSUS) {
        var listaCodSUSTable = document.getElementById("listaCodSUS");
        var newRow = listaCodSUSTable.insertRow(-1); // Insert at the end

        const checkBoxCell = newRow.insertCell(0);
        checkBoxCell.innerHTML = '<input type="checkbox" class="delete-checkbox">';
        checkBoxCell.className = "ui-state-default ui-th-column ui-th-ltr";

        var codesCell = newRow.insertCell(1);
        codesCell.textContent = codSUS.split(" - ")[0];
        codesCell.className = "ui-state-default ui-th-column ui-th-ltr";

        var nomeCell = newRow.insertCell(2);
        nomeCell.textContent = codSUS.split(" - ")[1];
        nomeCell.className = "ui-state-default ui-th-column ui-th-ltr";

        // Clear input field after adding row
        document.getElementById("atendimentoCodSUS").value = "";
    }
    
    function deleteSUSRows() {
        var checkboxes = document.getElementsByClassName("delete-checkbox");
        var table = document.getElementById("listaCodSUS");

        for (var i = checkboxes.length - 1; i >= 0; i--) {
            if (checkboxes[i].checked) {
                table.deleteRow(i + 1); // +1 because of the header row
            }
        }
    }

    function limparCampos() {
        document.getElementById("atendimentoData").value = "";
        document.getElementById("especialidade").value = "";
        document.getElementById("atendimentoDescrição").value = "";
        document.getElementById("responsavelProcedimento").value = "";
        document.getElementById("componenteCurricular").value = "";
    }
    </script>
</div>