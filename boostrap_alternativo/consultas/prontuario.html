<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Consultar paciente</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/apple-touch-icon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../assets/css/style.css" rel="stylesheet">

  <!-- DataTables CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
              
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- DataTables JS -->
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>

  <style>
    .hidden {
    display: none;
  }
  </style>
</head>

<body>

  <!-- ======= Mobile nav toggle button ======= -->
  <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">

      <div class="profile">
        <img src="../assets/img/logo_mini.jpg" alt="" class="img-fluid rounded-circle">
        <h1 class="text-light"><span id="Nome_usuario"></span></h1>
        
        <script>
          var Nome_usuario = document.getElementById("Nome_usuario");
          var usuario = JSON.parse(localStorage.getItem("usuario"));
          Nome_usuario.innerHTML = usuario.Nome;
        </script>
      </div>
    </div>

    <nav id="navbar" class="nav-menu navbar">
      <ul>
        <li><a href="../innerPage.html#hero" class="nav-link active"><i class="bx bx-home"></i> <span>Home</span></a></li>
        <li><a href="../innerPage.html#Consultas" class="nav-link"><i class="bi bi-search"></i> <span>Consultas</span></a></li>
        <li><a href="../innerPage.html#Cadastros" class="nav-link"><i class="bx bx-file-blank"></i> <span>Cadastros</span></a></li>
        <li><a href="../innerPage.html#Processos" class="nav-link"><i class="bx bx-server"></i> <span>Processos</span></a></li>
        <li data-permission="Administrador"><a href="../innerPage.html#Relatorios" class="nav-link"><i class="bi bi-file-earmark-bar-graph"></i><span>Relatórios</span></a></li>
        <li><a href="#../innerPage.htmltutoriais" class="nav-link"><i class="bi bi-youtube"></i><span>Tutoriais</span></a></li>
        <li><a href="#../innerPage.htmlcontact" class="nav-link"><i class="bx bx-envelope"></i> <span>Sugestões/Reportar erros</span></a></li>
        <br>
      </ul>
    </nav><!-- .nav-menu -->
    
    <button type="button" style="display: block; margin: 0 auto; width: 30%; color: maroon; border-radius: 2px; padding: auto;" onclick="window.location.href='index.html'">Logout</button>
    
  </header><!-- End Header -->

<main id="main">

<!-- ======= Breadcrumbs ======= -->
<section class="breadcrumbs">
    <div class="container">

        <div class="d-flex justify-content-between align-items-center" style="margin-left: 75px; width: 75vw">
            <h2>Paciente: <span id="pacienteHeader" style="color: maroon; font-weight: bold;"></span></h2>

            <ol>
                <li><spam style="color: maroon;">Prontuário do paciente</spam></li>
                <li><span id="tipo_usuarioHome"></span></li>
            </ol>
                     
            <script>
                var tipo_usuarioHome = document.getElementById("tipo_usuarioHome");
                var Nome_usuario = document.getElementById("Nome_usuario");
                var usuario = JSON.parse(localStorage.getItem("usuario"));
                
                Nome_usuario.innerHTML = usuario.Nome;
                tipo_usuarioHome.innerHTML = usuario.Tipo;
            </script>
        </div>
        
        <div class="breakLine2"></div>

        <div class="d-flex justify-content-between align-items-center" style="margin-left: 80px; z-index: 1000; width: auto;">
            <div class="tab-container">
                <div class="tab tab-active" onclick="changeTab(event, 'tab1')">Dados pessoais</div>
                <div class="tab" onclick="changeTab(event, 'tab2')">Demandas / Encaminhamentos</div>
                <div class="tab" onclick="changeTab(event, 'tab3')">Entrevistas dialogadas</div>
                <div class="tab" onclick="changeTab(event, 'tab4')">Planos de tratamento</div>
                <div class="tab" onclick="changeTab(event, 'tab5')">Histórico de atendimentos</div>
                <div class="tab" onclick="changeTab(event, 'tab6')">Exames complementares</div>
                <div class="tab" onclick="changeTab(event, 'tab7')">Faltas registradas</div>
            </div>
        </div>

    </div>
  </section><!-- End Breadcrumbs -->

      <!-- ======= Dados Section ======= -->
    <section id="Dados" class="O2Pages" style="margin-top: -50px; margin-left: -100px;">
        <div class="container tab-content tab-content-active" id="tab1">
            
            <div id="capaContent">
                <?php include('../tabs/capaConsulta.html'); ?>
              </div>
        </div>
    </section><!-- End Section -->

    <!-- ======= Endereco Section ======= -->
    <section id="Demandas" class="O2Pages">
        <div class="container tab-content" style="margin-left: -30px; margin-top: -50px;" id="tab2">


              
        </div>
    </section><!-- End Section -->

    <!-- ======= Entrevistas Section ======= -->
    <section id="Entrevistas" class="O2Pages">
        <div class="container tab-content" style="margin-left: -30px; margin-top: -50px;" id="tab3">


              
        </div>
    </section><!-- End Section -->

        <!-- ======= Planos Section ======= -->
        <section id="Planos" class="O2Pages">
            <div class="container tab-content" style="margin-left: -30px; margin-top: -50px;" id="tab4">
    
    
                  
        </div>
    </section><!-- End Section -->

    <!-- ======= Historico Section ======= -->
    <section id="Historico" class="O2Pages">
        <div class="container tab-content" style="margin-left: -30px; margin-top: -50px;" id="tab5">


                
        </div>
    </section><!-- End Section -->

    <!-- ======= Exames Section ======= -->
    <section id="Exames" class="O2Pages">
        <div class="container tab-content" style="margin-left: -30px; margin-top: -50px;" id="tab6">


                
        </div>
    </section><!-- End Section -->

     <!-- ======= Faltas Section ======= -->
     <section id="Faltas" class="O2Pages">
        <div class="container tab-content" style="margin-left: -30px; margin-top: -50px;" id="tab7">


                
        </div>
    </section><!-- End Section -->
            
            










  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>FO-UFPel</span></strong>
      </div>
      </div>
  </footer><!-- End  Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="../assets/vendor/typed.js/typed.umd.js"></script>
  <script src="../assets/vendor/waypoints/noframework.waypoints.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>

</body>

<script src="/API/API.js"></script>

<!-- SCRIPT CAPA -->
<script type="text/javascript">

    // CONVERTER DATA EM DD/MM/YYYY
    function formatDate(dateString) {
        const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
        const formattedDate = new Date(dateString).toLocaleDateString('en-GB', options);
        return formattedDate;
    }

    // Função para preencher o formulário com os dados do perfil
    function preencherFormulario(dados) {
        document.getElementById("informacoesImportantes").value = dados.informacoesImportantes;
        document.getElementById("Cpf").value = dados.CPF;
        document.getElementById("Nome").value = dados.Nome;
        document.getElementById("pacienteHeader").innerText = dados.Nome;
        document.getElementById("nomeSocial").value = dados.nomeSocial;
        document.getElementById("Nometab").innerText = dados.Nome;
        document.getElementById("Rg").value = dados.Rg;
        document.getElementById("CNS").value = dados.CNS;
        document.getElementById('DataNasc').value = formatDate(dados.DataNasc);
        document.getElementById("Email").value = dados.Email;
        document.getElementById("Tel").value = dados.Tel;
        document.getElementById("Tel2").value = dados.Tel2;
        document.getElementById("Tel3").value = dados.Tel3;
        document.getElementById("EstadoCivil").value = dados.EstadoCivil;
        document.getElementById("Sexo").value = dados.Sexo;
        document.getElementById("CorRaca").value = dados.CorRaca;
        document.getElementById("NomeMae").value = dados.NomeMae;
        document.getElementById("NomePai").value = dados.NomePai;
        document.getElementById("PNE").value = dados.PNE;
        document.getElementById("EnderecoTipo").value = dados.EnderecoTipo;
        document.getElementById("Cep").value = dados.Cep;
        document.getElementById("Rua").value = dados.Rua;
        document.getElementById("EndNumero").value = dados.EndNumero;
        document.getElementById("EndComplemento").value = dados.EndComplemento;
        document.getElementById("Bairro").value = dados.Bairro;
        document.getElementById("Cidade").value = dados.Cidade;
    }

    // Função para obter parâmetros da URL excluindo a parte após #
    function getUrlVars() {
        var vars = {};
        var url = window.location.href.split('#')[0]; // Exclude the portion after #
        var parts = url.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
            vars[key] = decodeURIComponent(value); // Decode URI component to handle special characters
        });
        return vars;
    }

    // Obter o CPF da URL
    var urlParams = getUrlVars();
    var cpfFromUrl = urlParams['cpf'];
    

    // Função para buscar o perfil usando a API
    function buscarPerfil() {
        const params = getUrlVars();
        const cpf = params['cpf'];
        const id = params['id'];

        if (cpf) {
            api.pacientes.consultar({ CPF: cpf, ID: id }) // Ensure that your API supports both 'cpf' and 'id' parameters
                .then((pacientes) => {
                    if (pacientes.length === 0) {
                        console.log('Nenhum paciente encontrado');
                    } else {
                        preencherFormulario(pacientes[0]);
                    }
                })
                .catch((error) => {
                    console.error('Erro ao consultar perfil:', error);
                });
        } else {
            console.log('CPF não encontrado na URL.');
        }
    }

    // Chamar a função para buscar o perfil
    buscarPerfil();
</script>


<script>
  //Filtra conteúdo por permissão do usuário
  function filterElementsByPermission() {
    const usuario = JSON.parse(localStorage.getItem('usuario'));
    const tipo = usuario ? usuario.Tipo : ''; // Get the user's permission type

    const elements = document.querySelectorAll('[data-permission]');
    elements.forEach(element => {
      const permission = element.getAttribute('data-permission');
      if (permission === tipo) {
        element.style.display = 'block'; // Display elements matching the user's permission
      } else {
        element.style.display = 'none'; // Hide elements not matching the user's permission
      }
    });
  }

  // Call the function to filter elements on page load
  filterElementsByPermission();
</script>
</html>